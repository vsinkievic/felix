<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Felix XREF analyser</title>
        <link rel="stylesheet" href="/felix/master.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <script src="/felix/jquery.js" type="text/javascript"></script>
        <script src="/felix/dropdown.js" type="text/javascript"></script>
        <script src="/felix/events.js" type="text/javascript"></script>

        <script LANGUAGE="SpeedScript">
            CREATE WIDGET-POOL.
        </script>
    </head>
    
    <body>
	    <script language="speedscript">
	            {ttDetails.i}
	            define variable cName as character no-undo.
	            define variable iType as integer no-undo init 0.
	            define variable cSystem as character no-undo.
	            define variable lDetails as logical init false no-undo.
	            define variable cUpdSystem as character no-undo.
	            define variable lClearFront as logical init true no-undo.
	
	            cName = get-field('name').
	            iType = integer(get-field('type')).
	            cUpdSystem = get-value('updSystem').
	            cSystem = get-field('system').
	            
	            if cName <> "" or iType > 0 or cUpdSystem <> "" then lClearFront = false.
	            
	            if get-field('details') <> "" then
	                lDetails = logical(get-field('details'), "yes/no").
	                
	            if get-field('delete') <> "" 
	            then do:
	                find first systems where systems.systemName = get-field('delete').
	                if available systems 
	                then do:
	                    delete systems.
	                    cSystem = "".
	                    cName = "".
	                    iType = 0.
	                    lDetails = false.
	                    cUpdSystem = "".
	                end.
	            end.
	            
	            if cUpdSystem = "add" 
	            then do:
	                if get-field('sysName') <> "" 
	                then do:
	                    find first systems where systems.systemName = get-field('oldName') no-error.
	                    if not available systems 
	                    then do:
	                        create systems.
	                        systems.systemName = get-field('sysName').
	                    end.
	                    systems.localSourcePath = get-field('sysPath').
	                    systems.systemPropath = get-field('sysPropath').
	                    systems.systemDBparameters = get-field('dbPar').
	                    systems.systemName = get-field("sysName").
	                end.
	            end.
	    </script>
	    	    
        <div class="container">
	        <div class="row page-header">
	            <div class="col-4">
	                <h1><a href="front.html"><span id="logo">Felix<sup>&reg</sup></a></span></h1>
	                <h4>XREF analyser</h4>
	            </div>
	            <div class="col-8 btn-block">
	                <form id="xrefForm">
	                    <div class="btn-group d-flex flex-wrap flex-md-nowrap" role="group" id="elements-holder">
	                        <input class="btn elements active" id="btn0" type="hidden">
	                        <input class="btn elements w-100" id="btn1" name="bProcedure" type="button" value="Procedure">
	                        <input class="btn elements w-100" id="btn2" name="bClass" type="button" value="Class">
	                        <input class="btn elements w-100" id="btn3" name="bInclude" type="button" value="Include">
	                        <div class="btn-group" role="group">
	                            <button id="btn4" type="button" class="btn elements dropdown-toggle w-100" data-toggle="dropdown" 
                                    aria-haspopup="true" aria-expanded="false">
                                    DB field 
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btn4">
                                    <a class="btn dropdown-item" id="btn4-1">ACCESS</a>
                                    <a class="btn dropdown-item" id="btn4-2">UPDATE</a>
                                </div>
	                        </div>
	                        <!-- <input class="btn elements w-100" id="btn4" name="bDBfield" 
	                        type="button" value="DB field"> -->
	                        <input class="btn elements w-100" id="btn5" name="bIndex" type="button" value="Index">
	                        <input class="btn w-100 user-guide-btn" id="btn6" name="buser-guide" 
	                            type="button" value="User Guide"
	                            style="background-color: #626060; color:white;">
	                    </div>
	
	                    <input id="inpType" type="hidden" name="type" value="`iType`">
	                    <div id="invFeedbackType" class="invalid-feedback">
	                        Please select type.
	                    </div>
	
	                    <div class="form-group d-flex flex-wrap flex-md-nowrap justify-content-between form-reports-input">
	                        <div class="w-90">
	                            <input class="form-control" autocomplete="off" name="name" id="inpName"
	                                placeholder="Please enter name" value="`cName`">
	                            <ul id="autocomplete"></ul>
	                            <div id="invFeedbackName" class="invalid-feedback">
	                                Please enter name.
	                            </div>
	                        </div>
	                        <div class="w-10">
	                            <button id="btnShort" type="submit" class="btn btn-block pull-right">Short report</button>
	                        </div>
	                        <div class="w-10">
	                            <button id="btnDetailed" type="submit" class="btn btn-block pull-right">Detailed report</button>
	                        </div>
	                        <input id="inpDetails" type="hidden" name="details" value="`get-field('details')`">
	                        <input id="inpSystem" type="hidden" name="system" value="`get-field('system')`">
	                    </div>
	                </form>
	            </div>
	        </div>
	                    
	        <div class="row report-section">
	            <div class="col-3">
	                <div class="list-group systems-list">
	                    <li class="list-group-item" id="list-heading">Available systems</li>
	                    <!--WSS for each systems: -->
	                        <!--WSS if systems.systemName = cSystem 
	                        then do:  -->                  
	                            <li class="list-group-item list-group-item-action systems-select-active" value='`systems.systemName`'> 
	                        <!--WSS end. 
	                        else do:-->
	                            <li class="list-group-item list-group-item-action systems-select" value='`systems.systemName`'>
	                        <!--WSS end. -->
	                                 <div class="row">
	                                     <div class="col-8">
	                                         `systems.systemName`
	                                     </div>
	                                     <div class="col-4 edit-system-holder">
	                                         <form action="front.html" class="pull-right">
                                                 <input class="btn btn-outline-dark edit-system" type="submit" name="updSystem"
                                                     value="edit">
                                                 <input type="hidden" name="sysName" value="`systems.systemName`">
                                             </form>
	                                     </div>
	                                 </div>
	                            </li>
	                    <!--WSS end. -->
	                </div>
	                <form action="front.html">
	                    <button type="submit" class="btn btn-block top-buffer" id="upd" name="updSystem" 
	                       value="new">Add new system</button>
	                </form>
	            </div>
	
	            <div class="col-9">
	                <div class="user-guide">
	                    <h3>System window overview</h3>
	                    <img class="user-guide-img" src="/felix/how_to_one" alt="Picture of how-to">
	                        <h5>1. Add new system.<h5>
		                    <p>Add new system for XREF analysis. You are prompted to input system name, 
		                        path to source files and propath, as well as database configuration data.</p>
                            <h5>2. Select from available (added) systems.<h5>
                            <p>Section "Available systems indicates systems or programs with XREF 
                                information prepared for analysis.</p>
                            <h5>3. Choose a type.<h5>
                            <p>Choose a type of the element you are searching: a procedure, a class, an include, 
                                a database field ("access" or "update"), or an index.</p>
                            <h5>4. Insert name.<h5>
                            <p>Insert a name of the element you are searching. The more correct and specific name 
                                 you enter, the better search results are displayed.</p>
                            <h5>5. Choose level of detail.<h5>
                            <p>Felix<sup>&reg</sup> XREF analyser outputs two types of reports: "Short report" 
                                shows only those ABL elements which are using the searched element; "Detailed report" 
                                includes path, call type, and repeated calls wwitin the same object, if any.</p>
	                    <h3>Example of short report</h3>
	                    <img class="user-guide-img" src="/felix/how_to_two" alt="Picture of how-to">
	                    <h3>Example of detailed report</h3>
	                    <img class="user-guide-img" src="/felix/how_to_three" alt="Picture of how-to">
	                </div>
	                
	                <!--WSS if lClearFront 
	                then do:  -->
                    <div class="about">
                        <h3>Explore Your Compilation Data. It's All About XREF.</h3>
                        <p>Felix<sup>&reg</sup> XREF analyses information on ABL elements, cross-references between 
                        procedures and ABL objects, and cross-references between class or interface definition files 
                        and ABL objects.</p>
                        <p>It's never been easier to find out what and where is using specific ABL elements in your 
                        sophisticated fyle system.</p>
                    </div>
                    <!--WSS end. -->
                
	                <!--WSS if cUpdSystem = "new" 
	                then do: -->
	                    <div class="form-holder">
	                        <form action='front.html'>
	                            <h3>New system for xref processing</h3>
	                            <label for="sysName">Name:</label>
	                            <input id="sysName" autocomplete="off" type="text" class="form-control"
	                                name="sysName" value="" placeholder="please enter system name" required>
	                            <label for="sysPath">Path:</label>
	                            <input id="sysPath" autocomplete="off" type="text" class="form-control"
	                                name="sysPath" placeholder="please enter system source path">
	                            <label for="sysPropath">Propath:</label>
	                            <input id="sysPropath" autocomplete="off" type="text" class="form-control"
	                                name="sysPropath" placeholder="please enter system propath">
	                            <label for="dbPar">Database:</label>
	                            <input id="dbPar" autocomplete="off" type="text" class="form-control"
	                                name="dbPar" placeholder="please enter system database parameters">
	                            <input type="hidden" name="updSystem" value="add">
	                            <div class="button-holder">
	                                <input class="btn btn-dark" type="submit">
	                            </div>
	                        </form>
	                    </div>
	                <!--WSS end. -->
	
	                <div class="form-holder">
	                    <!--WSS if cUpdSystem = "edit" 
	                    then do: -->
	                        <script language="speedscript">
		                        if get-field('sysName') <> "" 
		                        then do:
		                            find first systems where systems.systemName = get-field('sysName') no-error.
		                        end.
	                        </script>
	
		                    <form action='front.html'>
		                        <h3>Update system <span class="refName">`systems.systemName`</span> for xref processing</h3>
		                        <label for="sysName">Name:</label>
		                        <input id="sysName" autocomplete="off" type="text" class="form-control"
		                            name="sysName" value="`systems.systemName`" placeholder="please enter system name" required>
		                        <label for="sysPath">Path:</label>
		                        <input id="sysPath" autocomplete="off" type="text" class="form-control"
		                            name="sysPath" value="`systems.localSourcePath`" placeholder="please enter system source path">
		                        <label for="sysPropath">Propath:</label>
		                        <input id="sysPropath" autocomplete="off" type="text" class="form-control"
		                            name="sysPropath" value="`systems.systemPropath`" placeholder="please enter system propath">
		                        <label for="dbPar">Database:</label>
		                        <input id="dbPar" autocomplete="off" type="text" class="form-control"
		                            name="dbPar" value="`systems.systemDBparameters`" placeholder="please enter system database parameters">
		                        <input type="hidden" name="updSystem" value="add">
		                        <input type="hidden" name="oldName" value="`systems.systemName`">
		                            <div class="button-holder d-flex justify-content-between">
		                                <input class="btn btn-dark" type="submit" value="Update">
		                                <button type="button" class="btn btn-danger" data-toggle="modal"
		                                   data-target="#deleteModal" value="">Delete</button>
		                            </div>
		                    </form>
	                       
	                        <!-- Modal "Confirm delete" -->
		
                            <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="delModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title" id="delModalLabel">Delete system `systems.systemName`</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Delete system and all it's data from Felix<sup>&reg</sup>?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <form action="front.html">
                                            <button name="delete" type="submit" class="btn btn-danger" value="`systems.systemName`">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
	                    <!--WSS end.  -->
	                </div>            
	            
		            <!--WSS if cName <> "" and iType > 0 
		            then do:
		                if lDetails = false 
		                then do:
		                    case iType:
		                        when 1 then run findProcedure.p (input cName, output table ttDetails, input cSystem, input false).
		                        when 2 then run findClass.p (input cName, output table ttDetails, input cSystem, input false).
		                        when 3 then run findInclude.p (input cName, output table ttDetails, input cSystem).
                                when 41 then run findAccess.p (input cName, output table ttDetails, input cSystem, input false).
                                when 42 then run findUpdate.p (input cName, output table ttDetails, input cSystem, input false).
		                        when 5 then run findIndex.p (input cName, output table ttDetails, input cSystem, input false).
		                    end case. -->
		                    
		                    <div class='form-holder'>
                                <p class="output-message">Output of <span id="typeRef" class="refName"></span> matching "<span 
                                    class="refName">`cName`</span>" references (xref) in <span class="refName">`cSystem`</span>:</p>
		                        <table>
		                            <thead><th>Compile Unit</th></thead>
		                            <!--WSS for each ttDetails: -->
		                                <tr>
										    <td> `ttDetails.compileUnit` </td>
										</tr>
			                        <!--WSS end. -->
			                    </table>
		                    </div>
		                <!--WSS end.
		                else do:
		                    case iType:
		                        when 1 then run findProcedure.p (input cName, output table ttDetails, input cSystem, input true).
		                        when 2 then run findClass.p (input cName, output table ttDetails, input cSystem, input true).
		                        when 3 then run findInclude.p (input cName, output table ttDetails, input cSystem).
	                            when 41 then run findAccess.p (input cName, output table ttDetails, input cSystem, input true).
	                            when 42 then run findUpdate.p (input cName, output table ttDetails, input cSystem, input true).
		                        when 5 then run findIndex.p (input cName, output table ttDetails, input cSystem, input true).
		                    end case. -->                        
		                
							<div class='form-holder'>
                                <p class="output-message">Output of <span id="typeRef" class="refName"></span> matching "<span 
                                    class="refName">`cName`</span>" references (xref) in <span class="refName">`cSystem`</span>:</p>
								<table>
		                            <thead>
		                            <th class="t-1">Compile Unit</th><th class="t-2">File Name</th><th class="t-3">Source Path</th>
		                                <th>Type</th><th>Line</th><th class="t-4">Info</th>
		                            </thead>
								    <!--WSS for each ttDetails: -->
		                            <tr>
		                                <td class="t-1">`ttDetails.compileUnit`</td>
										<td class="t-2">`ttDetails.fileName`</td>
										<td class="t-3">`ttDetails.sourcePath`</td>
										<td>`ttDetails.type`</td>
										<td>`ttDetails.line`</td>
										<td class="t-4">`ttDetails.info`</td>
									</tr>
			    					<!--WSS end. -->
		                        </table>
		                    </div>
		                <!--WSS end. 
		            end. -->
	            </div>
            </div>
        <a href="javascript:" id="return-to-top"><span>&#x27A4;</span></s></a>
        </div>
    </body>
</html>

<script type="text/javascript">

/*--------- HIGHLIGHT BUTTON OF CURRENT TYPE:   ----------*/

    let type = parseInt(`iType`);
    switch(type) {
        case 1: 
            $('#btn1').addClass('active');
            $('#typeRef').html('procedure');
            break;
        case 2:
            $('#btn2').addClass('active');
            $('#typeRef').html('class');
            break;
        case 3:
            $('#btn3').addClass('active');
            $('#typeRef').html('include');
            break;
        case 41:
            $('#btn4').addClass('active');
            $('#btn4').html('DB: access');
            $('#typeRef').html('DB field ("ACCESS")');
            break;
        case 42:
            $('#btn4').addClass('active');
            $('#btn4').html('DB: update');
            $('#typeRef').html('DB field ("UPDATE")');
            break;
        case 5:
            $('#btn5').addClass('active');
            $('#typeRef').html("index");
            break;
    };
    
    /*--------- TABLE WIDTH ADJUSTMENT:   ----------*/
    
    let cwid = $('.page-header').width();
    let twid = $('table').width();
    let ratio = cwid / twid;
    
    if (ratio < 1.4) {
        for (let i = 1; i <= 4; i++) {
            let ewid = $('.t-' + i).width();
            $('.t-' + i).css({"maxWidth": ewid / 1.5, "wordWrap": "break-word"});
        }
    };
</script>

